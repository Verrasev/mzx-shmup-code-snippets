: "#drawbeams"
loop start
set "b3" to 1
: "drawloop"
set "b1" to "('pbeams&loopcount&_vx' * 'b3')"
set "b2" to "('pbeams&loopcount&_vy' * 'b3')"
if c?? CustomBlock p?? at "('plx'+'pbeams&loopcount&_x'+'b1')" "('ply'+'pbeams&loopcount&_y'+'b2')" then "drawloopdone"
if "((('plx'+'pbeams&loopcount&_x'+'b1')>=0)a(('ply'+'pbeams&loopcount&_y'+'b2')>=0)a(('plx'+'pbeams&loopcount&_x'+'b1')<'lyr_pb_w')a(('ply'+'pbeams&loopcount&_y'+'b2')<'lyr_pb_h'))" = 1 then "drawloopok"
goto "drawloopdone"
: "drawloopok"
goto "#drawbeam('pbeams&loopcount&_durationcount')"
copy block at "('spr_pb_x'+'pbeams&loopcount&_dir'+('local18'*8))" "('spr_pb_y'+'pbeams&loopcount&_type')" for "spr_pb_w" by "spr_pb_h" to "#('lyr_pb_x'+'pbeams&loopcount&_x'+'b1'+'plx')" "#('lyr_pb_y'+'pbeams&loopcount&_y'+'b2'+'ply')"
set "spr&local&_cx" to "('pbeams&loopcount&_x' + 'b1' + 'plx')"
set "spr&local&_cy" to "('pbeams&loopcount&_y' + 'b2' + 'ply')"
set "spr&local&_cwidth" to "spr_pb_w"
set "spr&local&_cheight" to "spr_pb_h"
set "spr&local&_clist" to 1
if "spr_collisions" <= 0 then "beamnextspaceb"
set "local2" to 0
: "collideb"
set "currentbeam" to "loopcount"
set "current_effect1effectid" to "pbeams&loopcount&_effect1effectid"
set "current_effect1subidchance" to "pbeams&loopcount&_effect1subidchance"
set "current_effect1power" to "pbeams&loopcount&_effect1power"
set "current_effect2effectid" to "pbeams&loopcount&_effect2effectid"
set "current_effect2subidchance" to "pbeams&loopcount&_effect2subidchance"
set "current_effect2power" to "pbeams&loopcount&_effect2power"
set "current_effect3effectid" to "pbeams&loopcount&_effect3effectid"
set "current_effect3subidchance" to "pbeams&loopcount&_effect3subidchance"
set "current_effect3power" to "pbeams&loopcount&_effect3power"
set "current_effect4effectid" to "pbeams&loopcount&_effect4effectid"
set "current_effect4subidchance" to "pbeams&loopcount&_effect4subidchance"
set "current_effect4power" to "pbeams&loopcount&_effect4power"
set "current_effect5effectid" to "pbeams&loopcount&_effect5effectid"
set "current_effect5subidchance" to "pbeams&loopcount&_effect5subidchance"
set "current_effect5power" to "pbeams&loopcount&_effect5power"
set "current_effect6effectid" to "pbeams&loopcount&_effect6effectid"
set "current_effect6subidchance" to "pbeams&loopcount&_effect6subidchance"
set "current_effect6power" to "pbeams&loopcount&_effect6power"
set "current_effect7effectid" to "pbeams&loopcount&_effect7effectid"
set "current_effect7subidchance" to "pbeams&loopcount&_effect7subidchance"
set "current_effect7power" to "pbeams&loopcount&_effect7power"
set "local20" to "pbeams&loopcount&_alliance"
send "spr('spr_clist&local2&')" to "#beamshot&local20&"
if "spr_clist&local2&" = "local" then "skippencheck"
if "pbeams&loopcount&_penetration" = 0 then "drawloopnopen"
: "skippencheck"
inc "local2" by 1
if "local2" < "spr_collisions" then "collideb"
: "beamnextspaceb"
inc "b3" by 1
goto "drawloop"
: "drawloopnopen"
set "spr&local&_cx" to 0
set "spr&local&_cy" to 0
set "spr&local&_cwidth" to 0
set "spr&local&_cheight" to 0
goto "drawloopdone"
: "drawloopdone"
loop for "('pbeams'-1)"
goto "#return"

: "#drawbeam1"
set "local18" to "pbeams&loopcount&_colora"
goto "#return"
: "#drawbeam2"
set "local18" to "pbeams&loopcount&_colorb"
goto "#return"
: "#drawbeam3"
set "local18" to "pbeams&loopcount&_colorc"
goto "#return"
: "#drawbeam4"
set "local18" to "pbeams&loopcount&_colord"
goto "#return"
